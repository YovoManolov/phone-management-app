databaseChangeLog:
    - changeSet:
          id: fk-ids-1
          author: yovo
#          preConditions:
#              - sqlCheck:
#                    dbms: postgres
#                    sql: "SELECT count(*) FROM information_schema.table_constraints WHERE constraint_name = 'fk_subscription_customer_subscription' AND table_name = 'customer_subscription' AND constraint_schema = 'subscriptions'"
#                    expectedResult: '0'
          changes:
              - sql:
                      dbms: postgres
                      sql: |
                          -- Deleting foreign key constraints before adding new ones
                          ALTER TABLE subscriptions.customer_subscription
                          DROP CONSTRAINT IF EXISTS fk_subscription_customer_subscription;
                          ALTER TABLE subscriptions.customer_subscription
                          DROP CONSTRAINT IF EXISTS fk_customer_customer_subscription;
                          ALTER TABLE customers.customer
                          DROP CONSTRAINT IF EXISTS fk_product_customer;
              - addForeignKeyConstraint:
                    baseTableSchemaName: subscriptions
                    baseTableName: customer_subscription
                    baseColumnNames: subscription_id
                    referencedTableSchemaName: subscriptions
                    referencedTableName: subscription
                    referencedColumnNames: id
                    constraintName: fk_subscription_customer_subscription
              - addForeignKeyConstraint:
                    baseTableSchemaName: subscriptions
                    baseTableName: customer_subscription
                    baseColumnNames: customer_id
                    referencedTableSchemaName: customers
                    referencedTableName: customer
                    referencedColumnNames: id
                    constraintName: fk_customer_customer_subscription
              - addForeignKeyConstraint:
                    baseTableSchemaName: customers
                    baseTableName: customer
                    baseColumnNames: product_id
                    referencedTableSchemaName: products
                    referencedTableName: product
                    referencedColumnNames: id
                    constraintName: fk_product_customer
